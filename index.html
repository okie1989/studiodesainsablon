
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Desain Kaos</title>
    <!-- Favicon Kalkulator -->
    <link rel="icon" 
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/calculator.svg" 
          type="image/svg+xml">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
:root {
    --primary-color: #4d8eff;
    --primary-hover: #3a7df5;
    --secondary-color: #7d8b94;
    --secondary-hover: #6c7a83;
    --background-color: #1a1a1a;
    --background-elevated: #252525;
    --background-elevated-2: #2e2e2e;
    --text-color: #ffffff;
    --text-secondary: #b0b0b0;
    --accent-color: #00c8ff;
    --success-color: #28a745;
    --border-radius: 12px;
    --box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    --transition-fast: all 0.15s ease-out;
}

body {
    font-family: "Exo 2", serif;
    max-width: 1400px;
    margin: 0 auto;
    padding: 30px;
    background: var(--background-color);
    color: var(--text-color);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
}

.studio-container {
    display: grid;
    grid-template-columns: 320px 1fr;
    gap: 30px;
    height: 90vh;
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.controls-panel {
    background: var(--background-elevated);
    padding: 20px;
    border-radius: var(--border-radius);
    overflow-y: auto;
    box-shadow: var(--box-shadow);
    border: 1px solid rgba(255, 255, 255, 0.05);
    scrollbar-width: thin;
    scrollbar-color: var(--primary-color) var(--background-elevated-2);
    max-height: fit-content;
}
.controls-panel::-webkit-scrollbar {
    width: 6px;
}

.controls-panel::-webkit-scrollbar-track {
    background: var(--background-elevated-2);
    border-radius: 3px;
}

.controls-panel::-webkit-scrollbar-thumb {
    background-color: var(--primary-color);
    border-radius: 3px;
}

.controls-section {
    margin-bottom: 6px;
    padding: 18px;
    background: var(--background-elevated-2);
    border-radius: var(--border-radius);
    transition: var(--transition);
    border-left: 3px solid transparent;
}

.controls-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border-left-color: var(--primary-color);
}

.controls-section h3 {
    margin-bottom: 15px;
    color: var(--primary-color);
    font-weight: 600;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 8px;
}

.controls-section h3::before {
    content: "";
    display: inline-block;
    width: 8px;
    height: 8px;
    background: var(--primary-color);
    border-radius: 50%;
}

.input-group {
    margin-bottom: 15px;
    position: relative;
}

.input-group label {
    display: flex;
    align-items: center;
    gap: 10px;
    color: var(--text-secondary);
    font-size: 0.95rem;
    margin-bottom: 6px;
    transition: var(--transition-fast);
}

.input-group label:hover {
    color: var(--text-color);
}

input[type=file], input[type=color] {
    display: none;
}

input[type=number] {
    width: 120px;
    padding: 8px 10px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    color: var(--text-color);
    font-size: 0.95rem;
    transition: var(--transition-fast);
}

input[type=number]:focus {
    border-color: var(--primary-color);
    outline: none;
    box-shadow: 0 0 0 2px rgba(77, 142, 255, 0.2);
}

/* Tata Letak Warna */
.color-options {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-top: 10px;
}

.color-swatch {
    width: 45px;
    height: 45px;
    border-radius: 10px;
    cursor: pointer;
    position: relative;
    transition: var(--transition);
}

.color-swatch::after {
    content: "";
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    border: 2px solid transparent;
    border-radius: 12px;
    transition: var(--transition);
}

.color-swatch.selected::after {
    border-color: var(--primary-color);
}

.sleeve-select {
    background: var(--background-elevated-2);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--text-color);
    padding: 8px;
    border-radius: 6px;
    width: 100%;
    margin-top: 5px;
}

button {
    background: var(--primary-color);
    color: #fff;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: var(--transition);
    display: inline-flex;
    align-items: center;
    gap: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

button:hover {
    background: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

button:active {
    transform: translateY(0);
}

button.secondary {
    background: var(--secondary-color);
}

button.secondary:hover {
    background: var(--secondary-hover);
}

button.icon-button {
    padding: 8px;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    display: inline-flex;
    justify-content: center;
    align-items: center;
}

.design-canvas {
    display: flex;
    flex-direction: column;
    gap: 20px;
    height: 100%;
}

.mockup-frame {
    position: relative;
    background: var(--background-elevated-2);
    border-radius: var(--border-radius);
    overflow: hidden;
    flex: 0 0 36%;
    box-shadow: var(--box-shadow);
    transition: var(--transition);
}

.mockup-frame:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.4);
}

.mockup-frame img.mockup {
    width: 100%;
    height: 100%;
    object-fit: contain;
}

.overlay-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: auto;
}

.design-overlay {
    position: absolute;
    pointer-events: all;
    border: 2px dashed rgba(255, 255, 255, 0.5);
    transform-origin: center;
    display: block;
    transition: var(--transition-fast);
}

.design-overlay:hover {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 2px rgba(0, 200, 255, 0.3);
}

.size-box {
    position: absolute;
    background: rgba(30, 30, 30, 0.9);
    border: 1px solid #444;
    border-radius: 8px;
    padding: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 100;
    width: fit-content;
    font-size: 14px;
    color: #eee;
    backdrop-filter: blur(4px);
}

.size-box-input-row {
    display: flex;
    align-items: center;
    gap: 2px;
    margin: 5px 0;
}

.size-box-input-row input {
    width: 20px;
    padding: 4px 6px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    color: white;
    font-size: 0.8rem;
    text-align: center;
}

.size-box-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 6px;
}

.size-box-input-group {
    display: flex;
    align-items: center;
    gap: 4px;
}

.size-box-input-group label {
    min-width: 40px;
}

.size-box-input-group input {
    width: 40px;
    padding: 2px 4px;
    background: #222;
    border: 1px solid #444;
    color: #eee;
    border-radius: 3px;
}

.size-box-options {
    grid-column: span 2;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 2px;
}

.checkbox-option {
    display: flex;
    align-items: center;
    gap: 4px;
}

.size-box-actions {
    grid-column: span 2;
    display: flex;
    justify-content: space-between;
    margin-top: 4px;
}

.size-box input[type="number"] {
    width: 80px;
    padding: 4px 6px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 4px;
    color: white;
    font-size: 0.8rem;
    text-align: center;
}

.size-box-buttons {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 4px;
    margin-top: 8px;
}

.size-box-buttons button {
    padding: 4px;
    margin: 0;
    font-size: 0.7rem;
    min-width: 0;
    display: flex;
    align-items: center;
    justify-content: center;
}

.size-box-buttons button i {
    font-size: 0.8rem;
}

.size-box-buttons button {
    position: relative;
}


.size-box-buttons button::after {
    content: attr(title);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.7rem;
    white-space: nowrap;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
}

.size-box-buttons button:hover::after {
    opacity: 1;
}


.size-box-input-row {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 8px;
}

.size-box-input-row input {
    width: 50px;
    padding: 4px;
    font-size: 0.8rem;
    text-align: center;
}

.size-box-confirm-btn {
    width: 100%;
    padding: 6px;
    margin-top: 5px;
    background: var(--success-color);
    font-size: 0.8rem;
}

.size-box-confirm-btn:hover {
    background: #218838;
}


@keyframes popIn {
    0% { transform: scale(0.9); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

.size-box button {
    padding: 6px 10px;
    margin: 2px;
    font-size: 0.85rem;
    width: max-content;
}

.price-display {
    background: var(--background-elevated-2);
    padding: 20px;
    border-radius: var(--border-radius);
    margin-top: auto;
    box-shadow: var(--box-shadow);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: all 0.3s ease;
}

.price-display:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
}

.price-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.price-icon {
    font-size: 1.5rem;
    animation: pulse 2s infinite;
}

.price-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: var(--primary-color);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.price-items {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 15px;
}

.price-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 10px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    transition: all 0.2s ease;
}

.price-item:hover {
    background: rgba(0, 0, 0, 0.3);
    transform: translateX(5px);
}

.price-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
}

.price-value {
    font-weight: 600;
    color: var(--accent-color);
}

.price-total {
    margin: 20px 0;
    padding: 15px;
    background: linear-gradient(135deg, rgba(77, 142, 255, 0.1), rgba(0, 200, 255, 0.1));
    border-radius: var(--border-radius);
    text-align: center;
    border: 1px solid rgba(0, 200, 255, 0.2);
    animation: glow 3s infinite alternate;
}

.total-label {
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.total-amount {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--accent-color);
    text-shadow: 0 0 10px rgba(0, 200, 255, 0.3);
    transition: all 0.3s ease;
}

.preview-btn {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 12px;
    margin-top: 10px;
    background: var(--primary-color);
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.preview-btn:hover {
    background: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.btn-icon {
    background: #333;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    color: #eee;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-icon:hover {
    background: #444;
}

.btn-icon.active {
    background: var(--primary-color);
    color: white;
}

.btn-text {
    font-size: 0.95rem;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

@keyframes glow {
    from { box-shadow: 0 0 5px rgba(0, 200, 255, 0.1); }
    to { box-shadow: 0 0 15px rgba(0, 200, 255, 0.3); }
}
.preview-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    z-index: 2000;
    padding: 20px;
    box-sizing: border-box;
    animation: fadeIn 0.3s ease-out;
    overflow-y: auto;
}

.preview-content {
    background: var(--background-elevated);
    max-width: 90%;
    width: 900px;
    margin: 40px auto;
    padding: 30px;
    border-radius: var(--border-radius);
    position: relative;
    color: white;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.05);
    animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    /* Pastikan konten tidak kepotong */
    max-height: calc(100vh - 80px);
    overflow-y: auto;
}

@keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

.preview-images {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 25px;
    margin: 25px 0;
}

.preview-image {
    position: relative;
    overflow: hidden;
    border-radius: 10px;
    transition: var(--transition);
}

.preview-image:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
}

.preview-image img {
    width: 100%;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    height: auto;
    object-fit: contain;
    background: #fff;
    display: block;
}

.preview-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 25px;
}

.close-btn {
    position: absolute;
    right: 20px;
    top: 20px;
    cursor: pointer;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: var(--transition-fast);
    background: rgba(255, 255, 255, 0.1);
    z-index: 10;
}

.close-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.close-btn::before, .close-btn::after {
    content: '';
    position: absolute;
    width: 20px;
    height: 2px;
    background: white;
}

.close-btn::before {
    transform: rotate(45deg);
}

.close-btn::after {
    transform: rotate(-45deg);
}

.price-detail-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
}

.price-detail-item span:last-child {
    font-weight: 600;
    color: var(--accent-color);
}

.crop-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 3000;
    padding: 20px;
    box-sizing: border-box;
    overflow: auto;
}

.crop-container {
    position: relative;
    max-width: 90%;
    width: 600px;
    margin: 20px auto;
    background: var(--background-elevated);
    padding: 20px;
    border-radius: var(--border-radius);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}

.crop-wrapper {
    position: relative;
    margin: 0 auto;
    max-width: 100%;
    max-height: 60vh;
    overflow: auto;
    border-radius: 8px;
}

.crop-box {
    position: absolute;
    border: 2px dashed var(--accent-color);
    background-color: rgba(0, 200, 255, 0.1);
    cursor: move;
    box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.7);
}

.crop-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
    align-items: center;
    justify-content: center;
}

.crop-controls button {
    padding: 8px 12px;
    font-size: 0.85rem;
}

.crop-input-group {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
}

.crop-input-group input {
    width: 60px;
    padding: 6px;
    text-align: center;
}

.price-summary {
    background: var(--background-elevated-2);
    border-radius: var(--border-radius);
    padding: 20px;
    margin: 20px 0;
    border: 1px solid rgba(255,255,255,0.1);
}

.price-detail {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
}

.price-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    border-bottom: 1px dashed rgba(255,255,255,0.1);
}

.price-row:last-child {
    border-bottom: none;
}

.price-label {
    font-size: 0.95rem;
    color: var(--text-color);
}

.price-value {
    font-weight: 600;
    color: var(--accent-color);
}

.size-info {
    font-size: 0.8rem;
    color: var(--text-secondary);
    margin-left: 5px;
}

.price-total {
    background: linear-gradient(135deg, rgba(77,142,255,0.1), rgba(0,200,255,0.1));
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    margin-top: 25px;
    border: 1px solid rgba(0,200,255,0.2);
}

.total-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.total-amount {
    font-size: 1.8rem;
    font-weight: 800;
    color: var(--accent-color);
    margin: 10px 0;
}

.total-note {
    font-size: 0.75rem;
    color: var(--text-secondary);
    opacity: 0.8;
}

.combined-btn {
    background: #064236;
    color: #2ae295;
    border: none;
    padding: 10px 15px;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
    width: 100%;
    PLACE-CONTENT: CENTER;
}

.combined-btn:hover {
    background: #076448;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}



/* Tooltip styles */
.tooltip {
    position: relative;
    display: inline-block;
}

.tooltip .tooltiptext {
    visibility: hidden;
    width: 180px;
    background-color: rgba(0, 0, 0, 0.9);
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 8px;
    position: absolute;
    z-index: 1;
    bottom: 125%;
    left: 50%;
    transform: translateX(-50%);
    opacity: 0;
    transition: opacity 0.3s;
    font-size: 0.85rem;
    backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
}

/* Responsive adjustments */
@media (max-width: 1200px) {
    .studio-container {
        grid-template-columns: 280px 1fr;
        gap: 20px;
    }
}

@media (max-width: 992px) {
    .studio-container {
        grid-template-columns: 1fr;
        height: auto;
    }
    
    .mockup-frame {
        flex: 0 0 300px;
    }
}

/* Loading animation */
@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

.loading {
    animation: pulse 1.5s infinite ease-in-out;
}
/* Responsive untuk modal */
@media (max-width: 768px) {
    .preview-content {
        max-width: 95%;
        padding: 20px;
        margin: 20px auto;
    }
    
    .preview-images {
        grid-template-columns: 1fr;
    }
}

/* Animasi tambahan */
@keyframes slideDown {
    from { transform: translateY(-20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
.size-box.position-top {
    animation: slideDown 0.3s ease-out;
}

/* Tambahkan di bagian CSS */
.locked-input {
    position: relative;
    background: rgba(0,0,0,0.2) !important;
    border-color: rgba(255,255,255,0.05) !important;
    cursor: not-allowed;
}

.locked-input::after {
    content: "üîí";
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
}

.admin-btn {
    background: linear-gradient(135deg, #ff5e62, #ff9966);
    margin-top: 5px;
}

.login-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 3000;
    align-items: center;
    justify-content: center;
}

.login-box {
    background: var(--background-elevated);
    padding: 30px;
    border-radius: var(--border-radius);
    width: 300px;
    text-align: center;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    animation: slideDown 0.3s ease-out;
}

.login-box h3 {
    margin-top: 0;
    color: var(--primary-color);
}

.login-box input {
    width: 100%;
    padding: 12px;
    margin: 15px 0;
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--primary-color);
    border-radius: 6px;
    color: white;
    font-size: 1rem;
}

.login-box button {
    width: 100%;
    margin-top: 10px;
}

.error-message {
    color: #ff5e62;
    margin-top: 10px;
    font-size: 0.9rem;
    display: none;
}

/* Tambahkan di bagian CSS */
#preview-download-area {
    background: var(--background-elevated);
    padding: 30px;
    color: var(--text-color);
    font-family: "Exo 2", sans-serif;
    width: 1000px;
    max-width: 100%;
    box-sizing: border-box;
}

#preview-download-header {
    text-align: center;
    font-weight: bold;
    font-size: 24px;
    margin-bottom: 20px;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

#preview-download-images {
    display: flex;
    gap: 30px;
    justify-content: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
}

#preview-download-images img {
    max-width: 450px;
    width: 100%;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

#preview-download-prices {
    background: var(--background-elevated-2);
    padding: 20px;
    border-radius: var(--border-radius);
    margin: 20px auto;
    max-width: 800px;
}

.price-download-row {
    display: grid;
    grid-template-columns: 1fr 1.5fr 1fr;
    justify-content: space-between;
    padding: 8px 0;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
    color: var(--text-secondary);
    font-size: 15px;
}

.price-download-row:last-child {
    border-bottom: none;
    font-weight: 600;
    color: var(--accent-color);
    font-size: 1.05rem;
    padding-top: 10px;
    margin-top: 5px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

#preview-download-total {
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    margin-top: 20px;
    color: var(--accent-color);
    padding: 15px;
    background: var(--background-elevated-2);
    border-radius: var(--border-radius);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}
.section-header {
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: var(--background-elevated-2);
    border-radius: 8px;
    transition: var(--transition-fast);
}

.section-header:hover {
    background: var(--background-elevated);
}

.collapse-icon {
    transition: transform 0.3s ease;
    font-size: 0.8rem;
    margin-left: 10px;
}

.section-content {
    max-height: 500px;
    overflow: hidden;
    transition: all 0.3s ease-in-out;
}

.section-content.collapsed {
    max-height: 0;
    padding-top: 0;
    padding-bottom: 0;
    margin-top: 0;
    margin-bottom: 0;
    opacity: 0;
}
.color-swatch:hover {
    transform: scale(1.1);
    box-shadow: 0 0 10px rgba(255,255,255,0.2);
}

.color-swatch:hover::after {
    border-color: rgba(255,255,255,0.3);
}
.blend-options {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px dashed rgba(255,255,255,0.1);
}

.blend-options label {
    font-size: 0.8rem;
    margin-right: 8px;
    color: var(--text-secondary);
}

.blend-select {
    flex-grow: 1;
    background: #222;
    border: 1px solid #444;
    color: #eee;
    border-radius: 3px;
    padding: 2px 4px;
    font-size: 12px;
}

.blend-select option {
    background: var(--background-elevated);
}

.preview-image {
    position: relative;
}

.image-options {
    margin-top: 10px;
    padding-top: 10px;
    border-top: 1px dashed rgba(255,255,255,0.1);
}

.image-options button {
    width: 100%;
    padding: 6px;
    margin-top: 5px;
    background: rgba(0,0,0,0.3);
    border: 1px solid var(--primary-color);
    color: white;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
    font-size: 0.8rem;
}

.image-options button:hover {
    background: rgba(0,0,0,0.5);
}

.image-options .icon {
    font-size: 1rem;
}

/* Style untuk toggle switch */
.toggle-box {
    position: relative;
    display: inline-block;
    width: 40px;
    height: 20px;
    margin-left: 8px;
}

.toggle-box input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #555;
    transition: .2s;
    border-radius: 20px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    transition: .2s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--primary-color);
}

input:checked + .slider:before {
    transform: translateX(20px);
}

/* Style untuk input number yang lebih baik */
.size-input {
    width: 50px;
    padding: 4px;
    background: #222;
    border: 1px solid #444;
    color: #eee;
    border-radius: 4px;
    text-align: center;
    font-size: 12px;
}

.size-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 1px var(--primary-color);
}

/* Animasi untuk size box */
.size-box {
    transition: opacity 0.2s, transform 0.2s;
}

.size-box-content {
    transition: all 0.2s ease;
}

/* Container Utama */
.size-box-container {
    position: absolute;
    background: rgba(40, 40, 40, 0.95);
    border-radius: 10px;
    padding: 12px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    width: 260px;
    z-index: 1000;
    border: 1px solid #555;
    backdrop-filter: blur(5px);
    border-bottom-left-radius: 13%;
}

/* Header */
.size-box-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid #555;
    font-weight: bold;
    font-size: 14px;
}

.btn-close {
    background: none;
    border: none;
    color: #aaa;
    font-size: 18px;
    cursor: pointer;
    padding: 0 5px;
}

.btn-close:hover {
    color: #fff;
}

/* Grid Layout */
.size-box-grid {
    display: grid;
    gap: 12px;
}

/* Input Group */
.size-input-group {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.size-input-group label {
    font-size: 12px;
    color: #ccc;
}

.size-input-group input {
    padding: 6px 8px;
    background: #333;
    border: 1px solid #555;
    border-radius: 4px;
    color: #fff;
    font-size: 13px;
}

.size-input-group input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 1px var(--primary-color);
}

/* Position Controls */
.position-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    margin: 8px 0;
}

.position-row {
    display: flex;
    gap: 8px;
    align-items: center;
}

.btn-nav {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #444;
    border: none;
    color: white;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-nav:hover {
    background: #555;
    transform: scale(1.1);
}

.btn-center {
    background: var(--primary-color);
    width: 40px;
    height: 40px;
    font-size: 18px;
}

.btn-center:hover {
    background: var(--primary-dark);
}

/* Advanced Options */
.advanced-options {
    display: grid;
    gap: 8px;
    margin-top: 8px;
}

.option-checkbox {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    cursor: pointer;
}

.blend-mode-selector {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.blend-mode-selector label {
    font-size: 12px;
    color: #ccc;
}

.blend-mode-selector select {
    padding: 5px;
    background: #333;
    border: 1px solid #555;
    border-radius: 4px;
    color: #fff;
    font-size: 12px;
}

.btn-invert {
    padding: 6px 10px;
    background: #333;
    border: 1px solid #555;
    border-radius: 4px;
    color: #fff;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.2s;
}

.btn-invert:hover {
    background: #444;
}

.btn-invert.active {
    background: var(--primary-color);
    border-color: var(--primary-dark);
}

/* Action Buttons */
.action-buttons {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 12px;
}

.btn-action {
    padding: 6px;
    background: #333;
    border: 1px solid #555;
    color: #fff;
    font-size: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all 0.2s;
}

.btn-action:hover {
    background: #444;
}

.btn-action .icon {
    font-size: 14px;
}

.btn-delete {
    background: #5a1a1a;
    border-color: #7a2a2a;
}

.btn-delete:hover {
    background: #7a2a2a;
}

.footer-note {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.8);
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-top: 1px solid rgba(255,255,255,0.1);
    backdrop-filter: blur(5px);
    font-family: "Exo 2", sans-serif;
}

.footer-text {
    font-weight: 300;
    font-style: italic;
    color: rgba(255,255,255,0.7);
    font-size: 0.9rem;
}

.social-links {
    display: flex;
    gap: 15px;
}

.social-link {
    color: rgba(255,255,255,0.7);
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 5px;
}

.social-link:hover {
    color: var(--primary-color);
    transform: translateY(-2px);
}

.social-link i {
    font-size: 1.2rem;
}
    </style>
</head>
<body>
    <div class="studio-container">
        <div class="controls-panel">
            <h2>APLIKASI CUSTOM TSHIRT PRICING</h2>
            <h3>BY. KANVAS MERCH</h3>
            <div class="controls-section">
                <h3>üé® Warna Kaos</h3>
                <div class="color-options">
                    <div class="color-swatch selected" data-color="white" style="background:#ffffff" data-sleeve="short"></div>
                    <div class="color-swatch" data-color="black" style="background:#000000" data-sleeve="short"></div>
                    <div class="color-swatch" data-color="red" style="background:#ff0000" data-sleeve="short"></div>
                    <div class="color-swatch" data-color="navy" style="background:#000080" data-sleeve="short"></div>
                    <div class="color-swatch" data-color="grey" style="background:#808080" data-sleeve="short"></div>
                </div>
                
                <div class="input-group" style="margin-top:15px;">
                    <label>Model Lengan:
                        <select id="sleeveType" class="sleeve-select">
                            <option value="short">Pendek</option>
                            <option value="long">Panjang</option>
                        </select>
                    </label>
                </div>
            </div>
            
            <div class="controls-section">
                <h3>Upload Desain</h3>
                <input type="file" id="uploadFront" accept="image/*">
                <input type="file" id="uploadBack" accept="image/*">
                <button onclick="uploadFront.click()">üìÅ Depan</button>
                <button onclick="uploadBack.click()">üìÅ Belakang</button>
            </div>
            
            <!-- Ganti bagian controls-section pengaturan harga dengan ini -->
<!-- Di dalam controls-panel -->
<div class="controls-section">
    <div class="section-header" onclick="togglePriceSettings()">
        <h3>‚öôÔ∏è Pengaturan Harga</h3>
        <span class="collapse-icon">‚ñº</span>
    </div>
    <div class="section-content" id="priceSettings">
        <div class="input-group">
            <label>Harga per cm¬≤:
                <input type="number" id="pricePerCm" value="20" class="locked-input" readonly>
            </label>
        </div>
        <div class="input-group">
            <label>Harga Kaos:
                <input type="number" id="basePrice" value="40000" class="locked-input" readonly>
            </label>
        </div>
        <div class="input-group">
            <label>Biaya Desain:
                <input type="number" id="designFee" value="0" class="locked-input" readonly>
            </label>
        </div>
        <button class="admin-btn" onclick="showLoginModal()">üîë Ubah Harga Dasar</button>
    </div>
</div>

<!-- Tambahkan modal login sebelum penutup body -->
<div class="login-modal" id="loginModal">
    <div class="login-box">
        <h3>Login Admin</h3>
        <p>Masukkan password untuk mengubah harga:</p>
        <input type="password" id="adminPassword" placeholder="Password">
        <div class="error-message" id="loginError">Password salah!</div>
        <button onclick="checkAdminPassword()">Masuk</button>
        <button class="secondary" onclick="closeLoginModal()">Batal</button>
    </div>
</div>
<div class="price-display">
    <div class="price-total">
        <div class="total-label">TOTAL HARGA</div>
        <div class="total-amount" id="totalPrice">Rp 0</div>
    </div>

    <div class="price-header">
        <div class="price-icon">üíµ</div>
        <h3>RINCIAN HARGA</h3>
    </div>
    
    <div class="price-items">
        <div class="price-item">
            <span class="price-label">Kaos Polos</span>
            <span class="price-value" id="basePriceDisplay">Rp 0</span>
        </div>
        <div class="price-item" id="frontPriceItem">
            <span class="price-label">Sablon Depan</span>
            <span class="price-value" id="frontPriceDisplay">-</span>
        </div>
        <div class="price-item" id="backPriceItem">
            <span class="price-label">Sablon Belakang</span>
            <span class="price-value" id="backPriceDisplay">-</span>
        </div>
        <div class="price-item">
            <span class="price-label">Biaya Desain</span>
            <span class="price-value" id="designFeeDisplay">Free</span>
        </div>
    </div>
    
    
    
    <button class="preview-btn" onclick="showPreview()">
        <span class="btn-icon">üëÅÔ∏è</span>
        <span class="btn-text">PREVIEW DESAIN</span>
    </button>
</div>
        </div>
        <div class="design-canvas">
            <div class="mockup-frame" id="frame-front">
                <img id="mockup-front" class="mockup" src="https://i.imgur.com/15xUlpY.jpeg" crossorigin="anonymous">
                <div class="overlay-container" id="overlay-container-front"></div>
            </div>
            <div class="mockup-frame" id="frame-back">
                <img id="mockup-back" class="mockup" src="https://i.imgur.com/1B2zntM.jpeg" crossorigin="anonymous">
                <div class="overlay-container" id="overlay-container-back"></div>
            </div>
        </div>
        <div class="footer-note">
            <div class="footer-text">
                Aplikasi dibuat oleh Kanvas Merchandise - Workshop: Jl. Riau Barat No.21, Kec. Sananwetan, Kota Blitar
            </div>
            <div class="social-links">
                <a href="https://wa.me/6282257423324" class="social-link" target="_blank">
                    <i class="fab fa-whatsapp"></i>
                    <span>082257423324</span>
                </a>
                <a href="https://instagram.com/kanvas.merch" class="social-link" target="_blank">
                    <i class="fab fa-instagram"></i>
                    <span>kanvas.merch</span>
                </a>
                <a href="https://tiktok.com/@kanvasmerch" class="social-link" target="_blank">
                    <i class="fab fa-tiktok"></i>
                    <span>kanvasmerch</span>
                </a>
            </div>
        </div>
    </div>

    

    <div class="preview-modal">
        <div class="preview-content">
            <span class="close-btn" onclick="closePreview()">&times;</span>
            <h2>Preview Desain</h2>
            
            <div class="preview-images">
                <div class="preview-image">
                    <h4>Depan</h4>
                    <img id="preview-front-img">
                </div>
                <div class="preview-image">
                    <h4>Belakang</h4>
                    <img id="preview-back-img">
                </div>
            </div>

            
            
            <div class="price-summary">
                <h3 style="margin-bottom:15px;color:var(--primary-color);border-bottom:1px solid rgba(255,255,255,0.1);padding-bottom:10px;">
                    üìã Rincian Biaya
                </h3>
                
                <div class="price-detail">
                    <div class="price-row">
                        <span class="price-label">Kaos Polos</span>
                        <span class="price-value" id="preview-base-price">Rp 0</span>
                    </div>
                    
                    <div class="price-row" id="preview-front-row">
                        <span class="price-label">Sablon Depan <span class="size-info" id="preview-front-size"></span></span>
                        <span class="price-value" id="preview-front-price">-</span>
                    </div>
                    
                    <div class="price-row" id="preview-back-row">
                        <span class="price-label">Sablon Belakang <span class="size-info" id="preview-back-size"></span></span>
                        <span class="price-value" id="preview-back-price">-</span>
                    </div>
                    
                    <div class="price-row">
                        <span class="price-label">Biaya Desain</span>
                        <span class="price-value" id="preview-design-fee">Free</span>
                    </div>
                </div>
                
                <div class="price-total">
                    <div class="total-label">TOTAL HARGA SATUAN</div>
                    <div class="total-amount" id="preview-total-price">Rp 0</div>
                    
                </div>
            </div>

            
            
            <div class="preview-actions">
                <button onclick="downloadCombinedPreview()" class="combined-btn">‚¨á Download </button>
            </div>
        </div>
    </div>
    <div class="crop-modal" id="cropModal">
        <div class="crop-container">
            <div id="cropImageContainer" style="position:relative"></div>
            <div style="text-align:center; margin-top:20px;">
               
            </div>
        </div>
    </div>
    <div id="preview-download-area" style="display:none;">
        <div id="preview-download-header">
            <span>üñºÔ∏è</span>
            <span>Preview Desain Kaos Custom</span>
        </div>
        <div id="preview-download-images">
            <div>
                <h4>Depan</h4>
                <img id="preview-download-front">
            </div>
            <div>
                <h4>Belakang</h4>
                <img id="preview-download-back">
            </div>
        </div>
        <div id="preview-download-prices">
            <h3 style="color: var(--primary-color); margin-top: 0; display: flex; align-items: center; gap: 8px;">
                <span>üßæ</span>
                <span>Rincian Harga</span>
            </h3>
            <div id="price-download-details"></div>
        </div>
        <div id="preview-download-total"></div>
    </div>


    
<script>
    const colorData = {
    white: {
        short: {
            front: 'https://i.imgur.com/15xUlpY.jpeg',
            back: 'https://i.imgur.com/1B2zntM.jpeg'
        },
        long: {
            front: 'https://i.imgur.com/shortcode-front-long.jpg',
            back: 'https://i.imgur.com/shortcode-back-long.jpg'
        }
    },
    black: {
        short: {
            front: 'https://i.imgur.com/N3zDDke.jpeg',
            back: 'https://i.imgur.com/8AheLaq.jpeg'
        },
        long: {
            front: 'https://i.imgur.com/shortcode-black-front-long.jpg',
            back: 'https://i.imgur.com/shortcode-black-back-long.jpg'
        }
    },
    // Tambahkan warna lain dengan URL gambar yang sesuai
};
    
let sizeBoxVisible = {
    front: true,
    back: true
};
    let currentColor = 'white';
    const uploadFront = document.getElementById('uploadFront');
    const uploadBack = document.getElementById('uploadBack');
    const mockups = { front: document.getElementById('mockup-front'), back: document.getElementById('mockup-back') };
    const containers = { front: document.getElementById('overlay-container-front'), back: document.getElementById('overlay-container-back') };
    const transforms = { front: {}, back: {} };

    document.getElementById('sleeveType').addEventListener('change', function() {
    updateMockupImage();
    updatePrice();
});

    document.querySelectorAll('.color-swatch').forEach(s => s.addEventListener('click', () => {
        document.querySelectorAll('.color-swatch').forEach(e => e.classList.remove('selected'));
        s.classList.add('selected'); 
        currentColor = s.dataset.color; 
        updateMockupImage();
    }));

    uploadFront.addEventListener('change', e => handleUpload(e, 'front'));
    uploadBack.addEventListener('change', e => handleUpload(e, 'back'));
    ['pricePerCm','basePrice','designFee'].forEach(id => {
    const input = document.getElementById(id);
    input.addEventListener('input', function() {
        if (isAdmin) {
            updatePrice();
        } else {
            // Reset nilai jika bukan admin mencoba mengubah
            this.value = this.defaultValue;
        }
    });
});

    function handleUpload(e, side) {
        const file = e.target.files[0]; 
        if (!file) return;
        const reader = new FileReader(); 
        reader.onload = ev => createOverlay(ev.target.result, side);
        reader.readAsDataURL(file); 
        e.target.value = '';
    }

    function createOverlay(src, side) {
    const el = document.createElement('img');
    el.src = src;
    el.className = 'design-overlay';
    containers[side].appendChild(el);
    
    // Terapkan filter awal
    applyImageFilters(el, transforms[side] || { inverted: false });
    
    initOverlay(el, side);
}
    

    function initOverlay(el, side) {
        transforms[side] = {
        x: 0, y: 0, width: 0, height: 0,
        angle: 0, ar: 1,
        box: null,
        proportional: true,
        interactable: null
        
        
    };
    

    el.onload = () => {
        const cont = containers[side];
        const ar = el.naturalWidth / el.naturalHeight;
        transforms[side].ar = ar;

        const w = Math.min(cont.offsetWidth * 0.7, 300);
        transforms[side].width = w;
        transforms[side].height = w / ar;
        centerOverlay(side);

        const box = document.createElement('div');
        box.className = 'size-box';
        cont.appendChild(box);
        transforms[side].box = box;

        const interactable = interact(el);
        transforms[side].interactable = interactable; // <== SIMPAN INTERACT INSTANCE

        applyInteractOptions(side); // <== PANGGIL KONFIGURASI

        update(el, side);
        updatePrice();
    };
}
function toggleInvert(side) {
    const overlay = containers[side].querySelector('.design-overlay');
    if (overlay) {
        transforms[side].inverted = !transforms[side].inverted;
        applyImageFilters(overlay, transforms[side]);
        updateBox(side); // Refresh tampilan sizebox
    }
}

function applyImageFilters(element, transform) {
    let filter = '';
    
    if (transform.inverted) {
        filter += 'invert(1) ';
    }
    
    // Tambahkan blend mode jika ada
    if (transform.blendMode && transform.blendMode !== 'normal') {
        element.style.mixBlendMode = transform.blendMode;
    } else {
        element.style.mixBlendMode = 'normal';
    }
    
    element.style.filter = filter;
    element.style.opacity = transform.inverted ? '0.9' : '1';
}

function applyInteractOptions(side) {
    const el = containers[side].querySelector('.design-overlay');
    const t = transforms[side];

    if (!el || !t || !t.interactable) return;

    const interactable = t.interactable;
    interactable.unset(); // reset dulu agar tidak conflict

    interact(el)
        .draggable({
            listeners: {
                move(ev) {
                    t.x += ev.dx;
                    t.y += ev.dy;
                    update(el, side);
                }
            }
        })
        .resizable({
            edges: { left: true, right: true, top: true, bottom: true },
            modifiers: [
                interact.modifiers.aspectRatio({
                    ratio: t.proportional ? t.ar : 'preserve',
                    enabled: t.proportional // ini penting!
                })
            ],
            listeners: {
                move(ev) {
                    t.width = ev.rect.width;
                    t.height = ev.rect.height;
                    t.x += ev.deltaRect.left;
                    t.y += ev.deltaRect.top;
                    update(el, side);
                }
            }
        })
        .gesturable({
            listeners: {
                move(ev) {
                    t.angle += ev.da;
                    update(el, side);
                }
            }
        });

    t.interactable = interactable;
}


    function update(el, side) {
        const t = transforms[side]; 
    el.style.transform = `translate(${t.x}px,${t.y}px) rotate(${t.angle}deg)`;
    el.style.width = t.width + 'px'; 
    el.style.height = t.height + 'px'; 
    updateBox(side); // Pastikan ini tetap ada!
}

function updateBox(side) {
    const t = transforms[side];
    const cont = containers[side];
    const box = t.box;
    if (!box) return;

    const wCm = (t.width / cont.offsetWidth) * 104;
    const hCm = (t.height / cont.offsetHeight) * 104;

    box.innerHTML = `
        <div class="size-box-container">
            <div class="size-box-header">
                <span>Edit Design</span>
                <button class="size-box-confirm-btn" onclick="confirmSizeChange('${side}')">UPDATE</button>
            </div>
            
            <div class="size-box-grid">
                <!-- Dimensi -->
                <div class="size-input-group">
                    <label>Width (cm):</label>
                    <input type="number" step="0.1" value="${wCm.toFixed(1)}" id="widthInput-${side}">
                </div>
                <div class="size-input-group">
                    <label>Height (cm):</label>
                    <input type="number" step="0.1" value="${hCm.toFixed(1)}" id="heightInput-${side}">
                </div>
                
                <!-- Kontrol Navigasi -->
                <div class="position-controls">
                    <div class="position-row">
                        <button class="btn-nav" onclick="moveOverlay('${side}', 0, -10)">‚Üë</button>
                    </div>
                    <div class="position-row">
                        <button class="btn-nav" onclick="moveOverlay('${side}', -10, 0)">‚Üê</button>
                        <button class="btn-nav btn-center" onclick="centerOverlay('${side}')">‚óã</button>
                        <button class="btn-nav" onclick="moveOverlay('${side}', 10, 0)">‚Üí</button>
                    </div>
                    <div class="position-row">
                        <button class="btn-nav" onclick="moveOverlay('${side}', 0, 10)">‚Üì</button>
                    </div>
                </div>
                
                <!-- Opsi Lanjutan -->
                <div class="advanced-options">
                    <label class="option-checkbox">
                        <input type="checkbox" ${t.proportional ? 'checked' : ''} 
                               onchange="toggleProportional('${side}', this.checked)">
                        Lock Aspect Ratio
                    </label>
                    
                    <div class="blend-mode-selector">
                        <label>Blend Mode:</label>
                        <select onchange="updateBlendMode('${side}', this.value)">
                            <option value="normal" ${t.blendMode === 'normal' ? 'selected' : ''}>Normal</option>
                            <option value="multiply" ${t.blendMode === 'multiply' ? 'selected' : ''}>Multiply</option>
                            <option value="screen" ${t.blendMode === 'screen' ? 'selected' : ''}>Screen</option>
                            <option value="overlay" ${t.blendMode === 'overlay' ? 'selected' : ''}>Overlay</option>
                        </select>
                    </div>
                    
                    <button class="btn-invert ${t.inverted ? 'active' : ''}" 
                            onclick="toggleInvert('${side}')">
                        ${t.inverted ? '‚òÄÔ∏è Original Colors' : 'üåë Invert Colors'}
                    </button>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-action" onclick="rotateOverlay('${side}', 90)">
                    <span class="icon">‚Üª</span> Rotate
                </button>
                <button class="btn-action" onclick="startCrop('${side}')">
                    <span class="icon">‚úÇÔ∏è</span> Crop
                </button>
                <button class="btn-action btn-delete" onclick="deleteOverlay('${side}')">
                    <span class="icon">üóëÔ∏è</span> Delete
                </button>
                
            </div>
        </div>
    `;

    // Setup event listeners
    setupEnhancedInputControls(side);
    positionSizeBox(side);
}

// Fungsi untuk pergerakan overlay
function moveOverlay(side, dx, dy) {
    const t = transforms[side];
    t.x += dx;
    t.y += dy;
    update(containers[side].querySelector('.design-overlay'), side);
}

// Fungsi setup kontrol input yang lebih baik
function setupEnhancedInputControls(side) {
    const widthInput = document.getElementById(`widthInput-${side}`);
    const heightInput = document.getElementById(`heightInput-${side}`);
    
    if (widthInput && heightInput) {
        // Gunakan input yang lebih responsif
        widthInput.addEventListener('change', () => applySizeFromInput(side, 'width'));
        heightInput.addEventListener('change', () => applySizeFromInput(side, 'height'));
        
        // Keyboard controls
        widthInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') applySizeFromInput(side, 'width');
        });
        heightInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') applySizeFromInput(side, 'height');
        });
    }
}

function toggleSizeBoxVisibility(side, isVisible) {
    sizeBoxVisible[side] = isVisible;
    const box = transforms[side].box;
    if (box) {
        const content = box.querySelector('.size-box-content');
        if (content) {
            content.style.display = isVisible ? 'block' : 'none';
        }
    }
}

function setupSizeInputs(side) {
    const widthInput = document.getElementById(`widthInput-${side}`);
    const heightInput = document.getElementById(`heightInput-${side}`);
    
    if (widthInput && heightInput) {
        // Hapus event listener lama jika ada
        widthInput.oninput = null;
        heightInput.oninput = null;
        
        // Tambahkan event listener baru dengan debounce
        widthInput.oninput = debounce(() => applySizeFromInput(side, 'width'), 300);
        heightInput.oninput = debounce(() => applySizeFromInput(side, 'height'), 300);
        
        // Tambahkan keyboard shortcuts
        widthInput.addEventListener('keydown', handleSizeInputKeydown);
        heightInput.addEventListener('keydown', handleSizeInputKeydown);
    }
}

// Fungsi debounce untuk input
function debounce(func, timeout = 300) {
    let timer;
    return (...args) => {
        clearTimeout(timer);
        timer = setTimeout(() => { func.apply(this, args); }, timeout);
    };
}

// Keyboard shortcuts untuk input ukuran
function handleSizeInputKeydown(e) {
    const input = e.target;
    const side = input.dataset.side;
    const dim = input.dataset.dim;
    
    // Enter untuk apply perubahan
    if (e.key === 'Enter') {
        confirmSizeChange(side);
        e.preventDefault();
    }
    // Arrow up/down untuk increment/decrement
    else if (e.key === 'ArrowUp') {
        input.stepUp();
        applySizeFromInput(side, dim);
        e.preventDefault();
    }
    else if (e.key === 'ArrowDown') {
        input.stepDown();
        applySizeFromInput(side, dim);
        e.preventDefault();
    }
}

// Fungsi untuk setup klik overlay
function setupOverlayClickHandler(side) {
    const overlay = containers[side].querySelector('.design-overlay');
    if (overlay) {
        // Hapus event listener lama jika ada
        overlay.onclick = null;
        
        // Tambahkan event listener baru
        overlay.onclick = (e) => {
            // Jika size box hidden, tampilkan saat overlay diklik
            if (!sizeBoxVisible[side]) {
                toggleSizeBoxVisibility(side, true);
                // Update checkbox
                const checkbox = transforms[side].box?.querySelector('.toggle-box input');
                if (checkbox) checkbox.checked = true;
            }
            
            // Hentikan propagasi agar tidak mengganggu drag
            e.stopPropagation();
        };
    }
}

function positionSizeBox(side) {
    const t = transforms[side];
    const cont = containers[side];
    const box = t.box;
    const overlay = cont.querySelector('.design-overlay');
    
    if (!box || !overlay) return;

    const overlayRect = overlay.getBoundingClientRect();
    const containerRect = cont.getBoundingClientRect();
    const boxRect = box.getBoundingClientRect();

    // Cari posisi optimal - prioritaskan pojok kanan atas overlay
    let topPosition = overlayRect.top - containerRect.top - boxRect.height - 5;
    let leftPosition = overlayRect.right - containerRect.left - boxRect.width;
    
    // Jika tidak cukup ruang di atas, taruh di bawah
    if (topPosition < 10) {
        topPosition = overlayRect.bottom - containerRect.top + 5;
    }
    
    // Jika tidak cukup ruang di kanan, taruh di kiri
    if (leftPosition + boxRect.width > containerRect.width - 10) {
        leftPosition = overlayRect.left - containerRect.left - boxRect.width;
        
        // Jika masih tidak cukup, paksa di dalam container
        if (leftPosition < 10) {
            leftPosition = 10;
        }
    }

    // Pastikan tidak keluar dari container
    topPosition = Math.max(10, Math.min(topPosition, containerRect.height - boxRect.height - 10));
    leftPosition = Math.max(10, Math.min(leftPosition, containerRect.width - boxRect.width - 10));

    // Terapkan posisi dengan animasi halus
    box.style.position = 'absolute';
    box.style.top = `${topPosition}px`;
    box.style.left = `${leftPosition}px`;
    box.style.opacity = '0';
    box.style.transition = 'opacity 0.2s, top 0.2s, left 0.2s';
    
    setTimeout(() => {
        box.style.opacity = '1';
    }, 10);
}


function confirmSizeChange(side) {
    const widthInput = document.getElementById(`widthInput-${side}`);
    const heightInput = document.getElementById(`heightInput-${side}`);
    const cont = containers[side];
    const t = transforms[side];

    const widthCm = parseFloat(widthInput.value) || 0;
    const heightCm = parseFloat(heightInput.value) || 0;

    t.width = (widthCm / 104) * cont.offsetWidth;
    t.height = (heightCm / 104) * cont.offsetHeight;

    const overlay = cont.querySelector('.design-overlay');
    update(overlay, side);
    updatePrice(); // Update harga setelah perubahan dikonfirmasi

    // Beri feedback visual
    const btn = t.box.querySelector('.size-box-confirm-btn');
    if (btn) {
        btn.textContent = '‚úì UPDATED';
        setTimeout(() => {
            btn.textContent = 'UPDATED';
        }, 1000);
    }
}


function applySizeFromInput(side, dimension) {
    const input = document.getElementById(`${dimension}Input-${side}`);
    const value = parseFloat(input.value) || 0;
    const cont = containers[side];
    const t = transforms[side];

    if (dimension === 'width') {
        t.width = (value / 104) * cont.offsetWidth;
        if (t.proportional) {
            t.height = t.width / t.ar;
            const heightInput = document.getElementById(`heightInput-${side}`);
            if (heightInput) heightInput.value = (t.height / cont.offsetHeight * 104).toFixed(1);
        }
    } else {
        t.height = (value / 104) * cont.offsetHeight;
        if (t.proportional) {
            t.width = t.height * t.ar;
            const widthInput = document.getElementById(`widthInput-${side}`);
            if (widthInput) widthInput.value = (t.width / cont.offsetWidth * 104).toFixed(1);
        }
    }

    const overlay = cont.querySelector('.design-overlay');
    if (overlay) {
        update(overlay, side);
    }
}

function toggleProportional(side, isProportional) {
    transforms[side].proportional = isProportional;
    applyInteractOptions(side);
    
    // Jika proporsional diaktifkan, sesuaikan height berdasarkan width
    if (isProportional) {
        const cont = containers[side];
        const t = transforms[side];
        const widthInput = document.getElementById(`widthInput-${side}`);
        const heightInput = document.getElementById(`heightInput-${side}`);
        
        if (widthInput && heightInput) {
            const widthCm = parseFloat(widthInput.value) || 0;
            const heightCm = widthCm / t.ar;
            heightInput.value = heightCm.toFixed(1);
        }
    }
}
function calculateAreaPrice(area) {
    const ppcm = parseFloat(document.getElementById('pricePerCm').value) || 0;
    return Math.round(area * ppcm);
}

function updatePriceFromBox(side) {
    const inputWidth = document.getElementById(`widthInput-${side}`);
    const inputHeight = document.getElementById(`heightInput-${side}`);
    
    if (inputWidth && inputHeight) {
        const widthValue = parseFloat(inputWidth.value) || 0;
        const heightValue = parseFloat(inputHeight.value) || 0;
        
        const cont = containers[side];
        const t = transforms[side];
        
        t.width = (widthValue / 104) * cont.offsetWidth;
        t.height = (heightValue / 104) * cont.offsetHeight;
        
        const overlay = cont.querySelector('.design-overlay');
        update(overlay, side);
        updatePrice();
        
        // Beri feedback visual
        const btn = t.box.querySelector('.update-price-btn');
        if (btn) {
            btn.innerHTML = '<span>‚úì</span> Updated!';
            setTimeout(() => {
                btn.innerHTML = '<span>üîÑ</span> Update Harga';
            }, 1500);
        }
    }
}

    let currentCropSide = null;
        let cropInteract = null;

        function startCrop(side) {
    currentCropSide = side;
    const overlay = containers[side].querySelector('.design-overlay');
    if (!overlay) return;

    const container = document.getElementById('cropImageContainer');
    container.innerHTML = `
        <div class="crop-wrapper">
            <img src="${overlay.src}" id="cropImg" style="max-height:60vh">
            <div class="crop-box" id="cropBox"></div>
        </div>
        <div class="crop-controls">
            <div class="crop-input-group">
                <span>Lebar:</span>
                <input type="number" id="cropWidth" value="100" min="10">
                <span>px</span>
            </div>
            <div class="crop-input-group">
                <span>Tinggi:</span>
                <input type="number" id="cropHeight" value="100" min="10">
                <span>px</span>
            </div>
            <label class="crop-input-group">
                <input type="checkbox" id="lockRatio" checked>
                <span>Proporsional</span>
            </label>
            <button onclick="resetCrop()">Reset</button>
            <button onclick="applyCrop()">Terapkan</button>
            <button class="secondary" onclick="closeCrop()">Batal</button>
        </div>
    `;

    // Inisialisasi crop box
    const cropBox = document.getElementById('cropBox');
    const img = document.getElementById('cropImg');
    
    // Set ukuran awal crop box
    const initSize = Math.min(img.width, img.height) * 0.3;
    cropBox.style.width = `${initSize}px`;
    cropBox.style.height = `${initSize}px`;
    cropBox.style.left = `${(img.width - initSize) / 2}px`;
    cropBox.style.top = `${(img.height - initSize) / 2}px`;
    
    syncCropInputs();
    
    // Interact.js untuk crop box
    cropInteract = interact(cropBox)
        .draggable({
            modifiers: [
                interact.modifiers.restrict({
                    restriction: img,
                    endOnly: true
                })
            ],
            listeners: {
                move(event) {
                    const x = (parseFloat(cropBox.style.left) || 0) + event.dx;
                    const y = (parseFloat(cropBox.style.top) || 0) + event.dy;
                    cropBox.style.left = `${x}px`;
                    cropBox.style.top = `${y}px`;
                    syncCropInputs();
                }
            }
        })
        .resizable({
            edges: { left: true, right: true, top: true, bottom: true },
            modifiers: [
                interact.modifiers.restrictEdges({
                    restriction: img
                }),
                interact.modifiers.aspectRatio({
                    ratio: 1,
                    enabled: document.getElementById('lockRatio').checked
                })
            ],
            listeners: {
                move(event) {
                    Object.assign(cropBox.style, {
                        width: `${event.rect.width}px`,
                        height: `${event.rect.height}px`,
                        left: `${(parseFloat(cropBox.style.left) || 0) + event.deltaRect.left}px`,
                        top: `${(parseFloat(cropBox.style.top) || 0) + event.deltaRect.top}px`
                    });
                    syncCropInputs();
                }
            }
        });

    // Event listeners untuk input
    document.getElementById('cropWidth').addEventListener('input', function() {
        if (document.getElementById('lockRatio').checked) {
            const height = this.value / (cropBox.offsetWidth / cropBox.offsetHeight);
            cropBox.style.height = `${height}px`;
            document.getElementById('cropHeight').value = Math.round(height);
        }
        cropBox.style.width = `${this.value}px`;
    });

    document.getElementById('cropHeight').addEventListener('input', function() {
        if (document.getElementById('lockRatio').checked) {
            const width = this.value * (cropBox.offsetWidth / cropBox.offsetHeight);
            cropBox.style.width = `${width}px`;
            document.getElementById('cropWidth').value = Math.round(width);
        }
        cropBox.style.height = `${this.value}px`;
    });

    document.getElementById('lockRatio').addEventListener('change', function() {
        cropInteract.resizable({
            modifiers: [
                interact.modifiers.aspectRatio({
                    ratio: 1,
                    enabled: this.checked
                })
            ]
        });
    });

    document.getElementById('cropModal').style.display = 'block';
}


function applyCrop() {
    const container = document.getElementById('cropImageContainer');
    const img = container.querySelector('img');
    const cropBox = container.querySelector('.crop-box');
    
    const scaleX = img.naturalWidth / img.offsetWidth;
    const scaleY = img.naturalHeight / img.offsetHeight;
    
    const canvas = document.createElement('canvas');
    canvas.width = cropBox.offsetWidth * scaleX;
    canvas.height = cropBox.offsetHeight * scaleY;
    
    const ctx = canvas.getContext('2d');
    ctx.drawImage(
        img,
        cropBox.offsetLeft * scaleX,
        cropBox.offsetTop * scaleY,
        canvas.width,
        canvas.height,
        0, 0,
        canvas.width,
        canvas.height
    );

    // Hapus overlay dan size box lama
    const containerOverlay = containers[currentCropSide];
    containerOverlay.querySelector('.design-overlay')?.remove();
    containerOverlay.querySelector('.size-box')?.remove();
    transforms[currentCropSide] = {};

    // Buat overlay baru dari hasil crop
    createOverlay(canvas.toDataURL(), currentCropSide);

    closeCrop();
    updatePrice();
}

function syncCropInputs() {
    const box = document.getElementById('cropBox');
    if (!box) return;
    
    document.getElementById('cropWidth').value = Math.round(box.offsetWidth);
    document.getElementById('cropHeight').value = Math.round(box.offsetHeight);
}

function resetCrop() {
    const img = document.getElementById('cropImg');
    const box = document.getElementById('cropBox');
    const size = Math.min(img.width, img.height) * 0.3;
    
    box.style.width = `${size}px`;
    box.style.height = `${size}px`;
    box.style.left = `${(img.width - size) / 2}px`;
    box.style.top = `${(img.height - size) / 2}px`;
    
    syncCropInputs();
}


        function closeCrop() {
            document.getElementById('cropModal').style.display = 'none';
            if (cropInteract) cropInteract.unset();
            currentCropSide = null;
        }


    function rotateOverlay(side, degrees) {
        transforms[side].angle += degrees;
        update(document.querySelector(`#overlay-container-${side} .design-overlay`), side);
    }

    function deleteOverlay(side) {
        const container = containers[side];
        container.querySelector('.design-overlay')?.remove();
        container.querySelector('.size-box')?.remove();
        transforms[side] = {};
        updatePrice();
    }

    function centerOverlay(side) {
    const t = transforms[side];
    const cont = containers[side];

    // hanya mengatur posisi horizontal (tengah kiri-kanan)
    t.x = (cont.offsetWidth - t.width) / 2;

    // posisi vertikal tetap (jangan sentuh t.y)
    update(document.querySelector(`#overlay-container-${side} .design-overlay`), side);
}


    function centerAllOverlays() {
        ['front','back'].forEach(side => {
            if (transforms[side].width) centerOverlay(side);
        });
    }

    function roundSablonPrice(price) {
    if (price < 10000) return 10000;
    const remainder = price % 1000;
    if (remainder <= 500) {
        return price - remainder; // ke bawah
    } else {
        return price + (1000 - remainder); // ke atas
    }
}

function updatePrice() {
    const ppcm = parseFloat(document.getElementById('pricePerCm').value) || 0;
    const base = parseFloat(document.getElementById('basePrice').value) || 0;
    const fee = parseFloat(document.getElementById('designFee').value) || 0;
    
    let cf = 0, cb = 0;
    let frontSize = '', backSize = '';
    
    ['front','back'].forEach(side => {
        const t = transforms[side];
        if (t.width && t.height) {
            const cont = containers[side];
            const wCm = (t.width / cont.offsetWidth) * 104;
            const hCm = (t.height / cont.offsetHeight) * 104;
            const area = wCm * hCm;
            const cost = roundSablonPrice(area * ppcm);
            
            if(side === 'front') {
                cf = cost;
                frontSize = ` (${wCm.toFixed(1)}√ó${hCm.toFixed(1)} cm)`;
            } else {
                cb = cost;
                backSize = ` (${wCm.toFixed(1)}√ó${hCm.toFixed(1)} cm)`;
            }
        }
    });
    
    const total = base + fee + cf + cb;
    
    // Update display
    document.getElementById('basePriceDisplay').textContent = `Rp ${base.toLocaleString()}`;
    document.getElementById('frontPriceDisplay').textContent = cf ? `Rp ${cf.toLocaleString()}${frontSize}` : '-';
    document.getElementById('backPriceDisplay').textContent = cb ? `Rp ${cb.toLocaleString()}${backSize}` : '-';
    document.getElementById('designFeeDisplay').textContent = fee ? `Rp ${fee.toLocaleString()}` : 'Free';
    document.getElementById('designFeeDisplay').style.color = fee ? 'var(--accent-color)' : 'var(--success-color)';
    
    // Animasi total harga
    const totalElement = document.getElementById('totalPrice');
    totalElement.textContent = `Rp ${total.toLocaleString()}`;
    totalElement.style.transform = 'scale(1.1)';
    setTimeout(() => {
        totalElement.style.transform = 'scale(1)';
    }, 300);
    
    // Tampilkan/sembunyikan item harga
    document.getElementById('frontPriceItem').style.display = cf ? 'flex' : 'none';
    document.getElementById('backPriceItem').style.display = cb ? 'flex' : 'none';
}

function showPreview() {
    // Generate preview images
    const frontCanvas = generatePreviewCanvas('front');
    const backCanvas = generatePreviewCanvas('back');
    
    // Update preview images
    document.getElementById('preview-front-img').src = frontCanvas.toDataURL();
    document.getElementById('preview-back-img').src = backCanvas.toDataURL();
    
    // Get price data
    const basePrice = parseFloat(document.getElementById('basePrice').value) || 0;
    const designFee = parseFloat(document.getElementById('designFee').value) || 0;
    const pricePerCm = parseFloat(document.getElementById('pricePerCm').value) || 0;
    
    // Update price display
    document.getElementById('preview-base-price').textContent = `Rp ${basePrice.toLocaleString()}`;
    document.getElementById('preview-design-fee').textContent = designFee > 0 ? `Rp ${designFee.toLocaleString()}` : 'Free';
    document.getElementById('preview-design-fee').style.color = designFee > 0 ? 'var(--accent-color)' : 'var(--success-color)';

    // Calculate print prices
    let frontPrice = 0;
    let backPrice = 0;
    
    ['front', 'back'].forEach(side => {
        const t = transforms[side];
        if (t.width && t.height) {
            const cont = containers[side];
            const wCm = (t.width / cont.offsetWidth) * 104;
            const hCm = (t.height / cont.offsetHeight) * 104;
            const area = wCm * hCm;
            const cost = roundSablonPrice(area * pricePerCm);
            
            document.getElementById(`preview-${side}-price`).textContent = `Rp ${cost.toLocaleString()}`;
            document.getElementById(`preview-${side}-size`).textContent = `(${wCm.toFixed(1)}√ó${hCm.toFixed(1)} cm)`;
            document.getElementById(`preview-${side}-row`).style.display = 'flex';

            if (side === 'front') {
                frontPrice = cost;
            } else {
                backPrice = cost;
            }
        } else {
            document.getElementById(`preview-${side}-row`).style.display = 'none';
        }
    });

    
    // Calculate total
    const total = basePrice + designFee + frontPrice + backPrice;
    document.getElementById('preview-total-price').textContent = `Rp ${total.toLocaleString()}`;
    
    // Show modal
    document.querySelector('.preview-modal').style.display = 'block';
}

    function generatePreviewCanvas(side) {
        const mockup = document.getElementById(`mockup-${side}`);
    const overlay = document.querySelector(`#overlay-container-${side} .design-overlay`);
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');

    // Buat temporary canvas untuk filter
         const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');
    
    // Dapatkan dimensi asli mockup
    canvas.width = mockup.naturalWidth;
    canvas.height = mockup.naturalHeight;
    
    // Gambar mockup ke canvas
    ctx.drawImage(mockup, 0, 0, canvas.width, canvas.height);
    
    if (overlay) {
        const t = transforms[side];
        const container = mockup.parentElement;

         
        
        
        // Hitung posisi dan ukuran overlay
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        const imageAspect = mockup.naturalWidth / mockup.naturalHeight;
        const containerAspect = containerWidth / containerHeight;
        
        let renderedWidth, renderedHeight, renderedLeft, renderedTop;
        if (imageAspect > containerAspect) {
            renderedWidth = containerWidth;
            renderedHeight = containerWidth / imageAspect;
        } else {
            renderedHeight = containerHeight;
            renderedWidth = containerHeight * imageAspect;
        }
        renderedLeft = (containerWidth - renderedWidth) / 2;
        renderedTop = (containerHeight - renderedHeight) / 2;
        
        // Faktor skala
        const scaleX = renderedWidth / mockup.naturalWidth;
        const scaleY = renderedHeight / mockup.naturalHeight;
        
        // Buat temporary canvas untuk blending
        const tempCanvas = document.createElement('canvas');
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tempCtx = tempCanvas.getContext('2d');
        
        // Gambar overlay ke temp canvas
        const imageX = (t.x - renderedLeft) / scaleX;
        const imageY = (t.y - renderedTop) / scaleY;
        const imageWidth = t.width / scaleX;
        const imageHeight = t.height / scaleY;
        
        tempCtx.save();
        tempCtx.translate(imageX + imageWidth/2, imageY + imageHeight/2);
        tempCtx.rotate(t.angle * Math.PI / 180);
        tempCtx.drawImage(
            overlay,
            -imageWidth/2,
            -imageHeight/2,
            imageWidth,
            imageHeight
        );
        tempCtx.restore();
        
        // Aplikasikan blend mode
        ctx.save();
        switch(t.blendMode) {
            case 'multiply':
                ctx.globalCompositeOperation = 'multiply';
                break;
            case 'screen':
                ctx.globalCompositeOperation = 'screen';
                break;
            case 'overlay':
                ctx.globalCompositeOperation = 'overlay';
                break;
            default:
                ctx.globalCompositeOperation = 'source-over';
        }
        
        ctx.drawImage(tempCanvas, 0, 0);
        ctx.restore();
    // Terapkan filter
    if (t.inverted) {
            tempCtx.globalCompositeOperation = 'difference';
            tempCtx.fillStyle = 'white';
            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
        }
        
        // Gambar ke canvas utama dengan blend mode
        ctx.globalCompositeOperation = t.blendMode || 'source-over';
        ctx.drawImage(tempCanvas, 0, 0);
    }
    
    return canvas;
}
function downloadCombinedPreview() {
    // Buat container sementara untuk render
    const container = document.createElement('div');
    container.style.width = '800px';
    container.style.padding = '20px';
    container.style.background = '#2a2a2a';
    container.style.color = 'white';
    container.style.fontFamily = '"Exo 2", sans-serif';
    container.style.position = 'absolute';
    container.style.left = '-9999px';
    document.body.appendChild(container);

    // Isi dengan konten preview
    container.innerHTML = `
        <div style="text-align:center; font-size:18px; margin-bottom:20px;">
            üñºÔ∏è Preview Desain Kaos
        </div>
        <div style="display:flex; gap:20px; justify-content:center; margin-bottom:20px;">
            <div>
                <h4 style="margin:0 0 10px 0;">Depan</h4>
                <img id="temp-front" style="max-width:350px; border:1px solid #444;">
            </div>
            <div>
                <h4 style="margin:0 0 10px 0;">Belakang</h4>
                <img id="temp-back" style="max-width:350px; border:1px solid #444;">
            </div>
        </div>
        <div id="temp-prices" style="background:#333; padding:15px; border-radius:8px;"></div>
    `;

    // Isi gambar dan harga
    document.getElementById('temp-front').src = document.getElementById('preview-front-img').src;
    document.getElementById('temp-back').src = document.getElementById('preview-back-img').src;
    
    // Clone price details
    const priceDetails = document.querySelector('.price-summary').cloneNode(true);
    priceDetails.style.background = 'transparent';
    priceDetails.style.boxShadow = 'none';
    document.getElementById('temp-prices').appendChild(priceDetails);

    

    // Render ke canvas
    html2canvas(container, {
        scale: 2,
        logging: false,
        useCORS: true,
        scrollX: 0,
        scrollY: 0,
        windowWidth: container.scrollWidth,
        windowHeight: container.scrollHeight
    }).then(canvas => {
        // Download gambar
        const link = document.createElement('a');
        link.download = 'desain-kaos-preview.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        // Hapus container sementara
        document.body.removeChild(container);
    }).catch(err => {
        console.error('Gagal generate preview:', err);
        alert('Maaf, gagal mengunduh preview. Silakan coba lagi.');
        document.body.removeChild(container);
    });
}


    function downloadPreview() {
        const frontCanvas = generatePreviewCanvas('front');
        const backCanvas = generatePreviewCanvas('back');
        
        const frontLink = document.createElement('a');
        frontLink.download = 'desain-depan.png';
        frontLink.href = frontCanvas.toDataURL();
        frontLink.click();
        
        const backLink = document.createElement('a');
        backLink.download = 'desain-belakang.png';
        backLink.href = backCanvas.toDataURL();
        backLink.click();
    }

    

    function closePreview() {
        document.querySelector('.preview-modal').style.display = 'none';
    }

    function updateMockupImage() {
    const sleeveType = document.getElementById('sleeveType').value;
    mockups.front.src = colorData[currentColor][sleeveType].front;
    mockups.back.src = colorData[currentColor][sleeveType].back;
    ['front','back'].forEach(side => containers[side].innerHTML = '');
}

// Tambahkan di bagian JavaScript
let isAdmin = false;

function showLoginModal() {
    document.getElementById('loginModal').style.display = 'flex';
    document.getElementById('adminPassword').focus();
}

function closeLoginModal() {
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('adminPassword').value = '';
    document.getElementById('loginError').style.display = 'none';
}

function checkAdminPassword() {
    const password = document.getElementById('adminPassword').value;
    const errorElement = document.getElementById('loginError');
    
    if (password === '123123') {
        isAdmin = true;
        unlockPriceInputs();
        closeLoginModal();
        // Beri feedback visual bahwa mode admin aktif
        document.querySelector('.admin-btn').textContent = 'üîì Mode Admin Aktif';
        document.querySelector('.admin-btn').style.background = 'linear-gradient(135deg, #00b09b, #96c93d)';
        setTimeout(() => {
            document.querySelector('.admin-btn').textContent = 'üîë Ubah Harga Dasar';
            document.querySelector('.admin-btn').style.background = 'linear-gradient(135deg, #ff5e62, #ff9966)';
        }, 3000);
    } else {
        errorElement.style.display = 'block';
        document.getElementById('adminPassword').value = '';
    }
}

function unlockPriceInputs() {
    const inputs = document.querySelectorAll('.locked-input');
    inputs.forEach(input => {
        input.readOnly = false;
        input.classList.remove('locked-input');
    });
}

function lockPriceInputs() {
    const inputs = document.querySelectorAll('#pricePerCm, #basePrice, #designFee');
    inputs.forEach(input => {
        input.readOnly = true;
        if (!input.classList.contains('locked-input')) {
            input.classList.add('locked-input');
        }
    });
}

function togglePriceSettings() {
    const content = document.getElementById('priceSettings');
    const icon = document.querySelector('.section-header .collapse-icon');
    
    content.classList.toggle('collapsed');
    icon.style.transform = content.classList.contains('collapsed') 
        ? 'rotate(180deg)' 
        : 'rotate(0deg)';
}

// Untuk collapse awal (opsional)
window.addEventListener('DOMContentLoaded', () => {
    document.getElementById('priceSettings').classList.add('collapsed');
});

function updateBlendMode(side, mode) {
    const overlay = containers[side].querySelector('.design-overlay');
    if (overlay) {
        transforms[side].blendMode = mode;
        overlay.style.mixBlendMode = mode;
        
        // Untuk browser yang tidak support mix-blend-mode
        overlay.style.opacity = mode === 'normal' ? '1' : '0.9';
    }
}
// Panggil lockPriceInputs saat inisialisasi
lockPriceInputs();

    updateMockupImage();
</script>
</body>
</html>
